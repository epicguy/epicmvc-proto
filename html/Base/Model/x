<script src="data:text/javascript;base64,Ly8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjQuMAooZnVuY3Rpb24oKSB7CiAgJ3VzZSBz dHJpY3QnOwoKICB2YXIgQXBwJEJhc2UsCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0 eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5 IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXld ID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNo aWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBl ID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJu IGNoaWxkOyB9OwoKICBBcHAkQmFzZSA9IChmdW5jdGlvbihfc3VwZXIpIHsKCiAgICBfX2V4dGVu ZHMoQXBwJEJhc2UsIF9zdXBlcik7CgogICAgZnVuY3Rpb24gQXBwJEJhc2Uodmlld19ubSwgb3B0 aW9ucykgewogICAgICB2YXIgc3M7CiAgICAgIHNzID0gewogICAgICAgIGY6IG51bGwsCiAgICAg ICAgdDogbnVsbCwKICAgICAgICBzOiBudWxsLAogICAgICAgIHNwOiBbXQogICAgICB9OwogICAg ICB0aGlzLmlzc3VlcyA9IG5ldyBFLklzc3VlKHRoaXMudmlld19ubSk7CiAgICAgIHRoaXMubWVz c2FnZXMgPSBuZXcgRS5Jc3N1ZSh0aGlzLnZpZXdfbm0pOwogICAgICBBcHAkQmFzZS5fX3N1cGVy X18uY29uc3RydWN0b3IuY2FsbCh0aGlzLCB2aWV3X25tLCBvcHRpb25zLCBzcyk7CiAgICB9Cgog ICAgQXBwJEJhc2UucHJvdG90eXBlLmdvVG8gPSBmdW5jdGlvbihmbG93LCB0LCBzKSB7CiAgICAg IHZhciBmLCB3YXMsIF9yZWY7CiAgICAgIGYgPSAnZ29Ubyc7CiAgICAgIHdhcyA9ICIiICsgdGhp cy5mICsgIi8iICsgdGhpcy50ICsgIi8iICsgdGhpcy5zOwogICAgICBpZiAoIWZsb3cgfHwgIShF LmFwcEdldEYoZmxvdykgIT0gbnVsbCkpIHsKICAgICAgICBfcmVmID0gKEUuYXBwR2V0U2V0dGlu ZygnZ28nKSkuc3BsaXQoJy8nKSwgZmxvdyA9IF9yZWZbMF0sIHQgPSBfcmVmWzFdLCBzID0gX3Jl ZlsyXTsKICAgICAgfSBlbHNlIGlmICghKHQgIT0gbnVsbCkgfHwgIShFLmFwcEdldFQoZmxvdywg dCkgIT0gbnVsbCkpIHsKICAgICAgICB0ID0gRS5hcHBTdGFydFQoZmxvdyk7CiAgICAgICAgcyA9 IEUuYXBwU3RhcnRTKGZsb3csIHQpOwogICAgICB9IGVsc2UgaWYgKCEocyAhPSBudWxsKSB8fCAh KEUuYXBwR2V0UyhmbG93LCB0LCBzKSAhPSBudWxsKSkgewogICAgICAgIHMgPSBFLmFwcFN0YXJ0 UyhmbG93LCB0KTsKICAgICAgfQogICAgICB0aGlzLmYgPSBmbG93OwogICAgICB0aGlzLnQgPSB0 OwogICAgICB0aGlzLnMgPSBzOwogICAgICBfbG9nMihmLCB7CiAgICAgICAgd2FzOiB3YXMsCiAg ICAgICAgaXM6ICIiICsgdGhpcy5mICsgIi8iICsgdGhpcy50ICsgIi8iICsgdGhpcy5zCiAgICAg IH0pOwogICAgICBpZiAod2FzICE9PSAoIiIgKyB0aGlzLmYgKyAiLyIgKyB0aGlzLnQgKyAiLyIg KyB0aGlzLnMpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaW52YWxpZGF0ZVRhYmxlcyhbJ1YnXSk7 CiAgICAgIH0KICAgIH07CgogICAgQXBwJEJhc2UucHJvdG90eXBlLmdvID0gZnVuY3Rpb24ocGF0 aCkgewogICAgICB2YXIgZiwgaXgsIHEsIHYsIF9pLCBfbGVuLCBfcmVmLCBfcmVmMTsKICAgICAg ZiA9ICdnbyc7CiAgICAgIHEgPSBwYXRoLnNwbGl0KCcvJyk7CiAgICAgIF9sb2cyKGYsICdiZWZv cmUnLCBxLCB0aGlzLmYsIHRoaXMudCwgdGhpcy5zKTsKICAgICAgX3JlZiA9IFt0aGlzLmYsIHRo aXMudCwgdGhpcy5zXTsKICAgICAgZm9yIChpeCA9IF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3Ro OyBfaSA8IF9sZW47IGl4ID0gKytfaSkgewogICAgICAgIHYgPSBfcmVmW2l4XTsKICAgICAgICBp ZiAoISgoX3JlZjEgPSBxW2l4XSkgIT0gbnVsbCA/IF9yZWYxLmxlbmd0aCA6IHZvaWQgMCkpIHsK ICAgICAgICAgIHFbaXhdID0gdjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYnJlYWs7CiAg ICAgICAgfQogICAgICB9CiAgICAgIF9sb2cyKGYsICdhZnRlcicsIHEsIHRoaXMuZiwgdGhpcy50 LCB0aGlzLnMpOwogICAgICByZXR1cm4gdGhpcy5nb1RvKHFbMF0sIHFbMV0sIHFbMl0pOwogICAg fTsKCiAgICBBcHAkQmFzZS5wcm90b3R5cGUuYXBwR2V0ID0gZnVuY3Rpb24oYXR0cikgewogICAg ICByZXR1cm4gRS5hcHBHZXRTZXR0aW5nKGF0dHIsIHRoaXMuZiwgdGhpcy50LCB0aGlzLnMpOwog ICAgfTsKCiAgICBBcHAkQmFzZS5wcm90b3R5cGUuZ2V0U3RlcFBhdGggPSBmdW5jdGlvbigpIHsK ICAgICAgcmV0dXJuIFt0aGlzLmYsIHRoaXMudCwgdGhpcy5zXTsKICAgIH07CgogICAgQXBwJEJh c2UucHJvdG90eXBlLmFjdGlvbiA9IGZ1bmN0aW9uKGN0eCwgYWN0LCBwKSB7CiAgICAgIHZhciBp LCBtLCBxLCByOwogICAgICByID0gY3R4LnIsIGkgPSBjdHguaSwgbSA9IGN0eC5tOwogICAgICBz d2l0Y2ggKGFjdCkgewogICAgICAgIGNhc2UgJ3BhdGgnOgogICAgICAgICAgcmV0dXJuIHRoaXMu Z28ocC5wYXRoKTsKICAgICAgICBjYXNlICdwdXNoJzoKICAgICAgICAgIHJldHVybiB0aGlzLnNw LnB1c2goW3RoaXMuZiwgdGhpcy50LCB0aGlzLnNdKTsKICAgICAgICBjYXNlICdwb3AnOgogICAg ICAgICAgaWYgKHRoaXMuc3AubGVuZ3RoKSB7CiAgICAgICAgICAgIHEgPSB0aGlzLnNwLnBvcCgp OwogICAgICAgICAgICByZXR1cm4gdGhpcy5nb1RvKHFbMF0sIHFbMV0sIHFbMl0pOwogICAgICAg ICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnYWRkX21lc3NhZ2UnOgogICAgICAg ICAgcmV0dXJuIG0uYWRkKHAudHlwZSwgcC5tc2dzKTsKICAgICAgICBjYXNlICdhZGRfaXNzdWUn OgogICAgICAgICAgcmV0dXJuIGkuYWRkKHAudHlwZSwgcC5tc2dzKTsKICAgICAgICBjYXNlICdj bGVhcic6CiAgICAgICAgICB0aGlzLmlzc3VlcyA9IG5ldyBFLklzc3VlKHRoaXMudmlld19ubSk7 CiAgICAgICAgICB0aGlzLm1lc3NhZ2VzID0gbmV3IEUuSXNzdWUodGhpcy52aWV3X25tKTsKICAg ICAgICAgIHJldHVybiB0aGlzLmludmFsaWRhdGVUYWJsZXMoWydJc3N1ZScsICdNZXNzYWdlJ10p OwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gQXBwJEJhc2UuX19zdXBlcl9fLmFj dGlvbi5jYWxsKHRoaXMsIGN0eCwgYWN0LCBwKTsKICAgICAgfQogICAgfTsKCiAgICBBcHAkQmFz ZS5wcm90b3R5cGUuc2V0SXNzdWVzID0gZnVuY3Rpb24oaXNzdWVfb2JqKSB7CiAgICAgIGlmICgo aXNzdWVfb2JqICE9IG51bGwgPyBpc3N1ZV9vYmouY291bnQoKSA6IHZvaWQgMCkgIT09IDApIHsK ICAgICAgICB0aGlzLmlzc3Vlcy5hZGRPYmooaXNzdWVfb2JqKTsKICAgICAgfQogICAgICByZXR1 cm4gdGhpcy5pbnZhbGlkYXRlVGFibGVzKFsnSXNzdWUnXSk7CiAgICB9OwoKICAgIEFwcCRCYXNl LnByb3RvdHlwZS5zZXRNZXNzYWdlcyA9IGZ1bmN0aW9uKGlzc3VlX29iaikgewogICAgICBpZiAo KGlzc3VlX29iaiAhPSBudWxsID8gaXNzdWVfb2JqLmNvdW50KCkgOiB2b2lkIDApICE9PSAwKSB7 CiAgICAgICAgdGhpcy5tZXNzYWdlcy5hZGRPYmooaXNzdWVfb2JqKTsKICAgICAgfQogICAgICBy ZXR1cm4gdGhpcy5pbnZhbGlkYXRlVGFibGVzKFsnTWVzc2FnZSddKTsKICAgIH07CgogICAgQXBw JEJhc2UucHJvdG90eXBlLmxvYWRUYWJsZSA9IGZ1bmN0aW9uKHRibF9ubSkgewogICAgICB2YXIg bWFwOwogICAgICBtYXAgPSBFWydpc3N1ZXMkJyArIHRoaXMuYXBwR2V0KCdncm91cCcpXTsKICAg ICAgdGhpcy5UYWJsZVt0Ymxfbm1dID0gKGZ1bmN0aW9uKCkgewogICAgICAgIHN3aXRjaCAodGJs X25tKSB7CiAgICAgICAgICBjYXNlICdNZXNzYWdlJzoKICAgICAgICAgICAgcmV0dXJuIHRoaXMu bWVzc2FnZXMuYXNUYWJsZShtYXApOwogICAgICAgICAgY2FzZSAnSXNzdWUnOgogICAgICAgICAg ICByZXR1cm4gdGhpcy5pc3N1ZXMuYXNUYWJsZShtYXApOwogICAgICAgICAgY2FzZSAnVic6CiAg ICAgICAgICAgIHJldHVybiBbRS5hcHBHZXRWYXJzKHRoaXMuZiwgdGhpcy50LCB0aGlzLnMpXTsK ICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybiBBcHAkQmFzZS5fX3N1cGVyX18u bG9hZFRhYmxlLmNhbGwodGhpcywgdGJsX25tKTsKICAgICAgICB9CiAgICAgIH0pLmNhbGwodGhp cyk7CiAgICB9OwoKICAgIHJldHVybiBBcHAkQmFzZTsKCiAgfSkoRS5Nb2RlbEpTKTsKCiAgRS5N b2RlbC5BcHAkQmFzZSA9IEFwcCRCYXNlOwoKfSkuY2FsbCh0aGlzKTsK"></script>
