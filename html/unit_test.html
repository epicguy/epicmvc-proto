<!DOCTYPE html>
<html lang="en">
<head>
  <title>UnitTest EpicMvc (Dev Dev)</title>
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"/>
<style>
[data-e-action] {
    -webkit-user-select: none; /* webkit (safari, chrome) browsers */
    -moz-user-select: none; /* mozilla browsers */
    -khtml-user-select: none; /* webkit (konqueror) browsers */
    -ms-user-select: none; /* IE10+ */
}
</style>
  <script type="text/javascript" src="mithril.js"></script>
  <script type="text/javascript" src="EpicCore.js"></script>
  <script type="text/javascript" src="Base/manifest.js"></script>
  <script type="text/javascript" src="Dev/manifest.js"></script>
  <script type="text/javascript" src="Proto/manifest.js"></script> <!-- To test Proto package -->
  <script type="text/javascript" src="Dev/Extra/LoadStrategy.js"></script>

<script type="text/coffeescript">
E.app$World=
	MODELS: Thing: class:'Thing', inst:'world_thing'
	ACTIONS:
		toggle: do: 'Thing.toggle'
		update_time: do: 'Thing.'

class Thing extends window.E.ModelJS
	constructor: ( view_nm, options) ->
		ss= world: true
		super view_nm, options, ss
		#setInterval (=> @invalidateTables ['Time']), 200
	action: (ctx, app, p) ->
		switch app
			when 'toggle'
				@world= not @world
				@invalidateTables ['Choices']
			when 'update_time'
				@invalidateTables ['Time']
	loadTable: (tbl_nm) ->
		switch tbl_nm
			when 'Choices'
				row= is_world: if @world then 'yes' else ''
				@Table[ tbl_nm]= [ row]
			when 'Time'
				row= now: new Date().toString()
				@Table[ tbl_nm]= [ row]

E.Model.Thing= Thing
</script>

<script type="x/template" id="view-Layout-default">
	<h4>I am a layout</h4>
	<h2 e-click='toggle'>Hello &Thing/Choices/is_world#?World?Dude;. (normal click)</h2>
	<e-page/>
</script>
<script type="x/template" id="view-Page-default">
	<h4>I am a page.</h4>
	<h2 ex-attr-scroll_top-int="1" e-click='toggle'>Hello again &Thing/Choices/is_world#?World?Dude;. (scroll top)</h2>
	<e-part part="other">
</script>
<script type="x/template" id="view-Part-other">
	<h4 ex-attr-oncontextmenu-func="return false;">I am a part. (no context menu)</h4>
	<h2 e-rclick='toggle'>Hello again and again <span>&Thing/Choices/is_world#?World?Dude; (right click)</span>.</h2>
	<e-part part="time">
</script>
<script type="x/template" id="view-Part-time">
<div e-click="update_time">Time is <span>&Thing/Time/now;</span></div>
</script>
</head>

<body id="base-body">
<script type="text/coffeescript">
	# If this isnt coffeescript, it runs too soon, such that E.Thing is not defined (E.app$World not yet set)
	E.run ['Base', 'Dev', 'Proto', 'World'], loadDirs: Base: './', Dev: './', Proto: './'
</script>
  <script type="text/javascript" src="coffee-script.js"> </script>
</body>
</html>

