/* Copyright 2007-2014 by James Shelby, shelby (at:) dtsol.com; All rights reserved. */
/*EpicCore*/(function(){"use strict";var e,t,n,r,i,s,o,u,a,l=[].slice,c=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};i=function(e,t){var r,s,o,u,a,c,h,p,d,v,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y;R=!1,D=0,o={},s={},V={},X={},A=[],J={load_dirs:[]},r={},r.nextCounter=function(){return++D},Q=function(e){return{}.toString.call(e)[8]},z=function(){var e,n,r,i,s,o,u,a,f,c,h,p;r=arguments[0],a=2<=arguments.length?l.call(arguments,1):[],o="O",e="A",c="U",f="S",n=0,s={},s[o]=function(e,n){var r,s;if(Q(n)!==o)return t;for(s in n)r=i(e[s],n[s]),r!==t&&(e[s]=r);return t},s[e]=function(n,r){var s,o,u,a,f;Q(r)!==e&&reutrn(t);for(o=a=0,f=r.length;a<f;o=++a)u=r[o],s=i(n[o],u),s!==t&&(n[o]=s);return t},s[c]=function(t,n){var r;switch(Q(n)){case o:r={},s[o](r,n);break;case e:r=[],s[e](r,n);break;default:r=n}return r},s[f]=function(e,t){return Q(t)in s?t:e},i=function(e,t){var r,i;return n++,i=Q(e),i in s||(i=f),r=s[i](e,t),n--,r};for(h=0,p=a.length;h<p;h++)u=a[h],i(r,u);return r},r.login=function(){var e,t,n;n=[];for(e in V)t=V[e],n.push(typeof t.eventLogin=="function"?t.eventLogin():void 0);return n},r.logout=function(e,t){var n=this;if(R!==!1){setTimeout(function(){return r.logout(e,t)},100);return}return e?M(e,t).then(function(){return q()}):q()},q=function(){var e,t;for(e in V){t=V[e];if(typeof t.eventLogout=="function"?!t.eventLogout():!void 0)continue;delete modelState[e],delete V[e]}return X={}},r.fist=function(e,t){var n,i,s,o,u,a;return t||(a=r.App().getStepPath(),n=a[0],o=a[1],t=r.oA.getGroupNm(n(o))),i=r.fistGrp().fist(t,e),s=""+t+"_"+i,s in X||(u=r.oA.fist(t,i),X[s]=new r.Fist(t,i,u,e)),X[s]},r.run=function(e,t){var n;A=e,T(),z(J,t),r.oLoader=new s[J.loader](A),n=r.oLoader.D_loadAsync(),n.then(function(){return r.App().go(p.go),r.oRender=new s[J.render]})},M=function(e,t){return R!==!1&&typeof J.c1=="function"&&J.c1(),R=e,m.startComputation(),_(e,t,r.App().getStepPath()).then(function(e){var t,n,i,s;r.App().setIssues(e[0]),r.App().setMessages(e[1]),R=!1,n={};for(t in V)i=V[t],i.saveState!=null&&(s=i.saveState())&&(n[t]=s);return m.endComputation()})},K=function(e){var t,n,r,i;e!=null&&(n=e),i=[];for(t in V)i.push(typeof (r=V[t]).restoreState=="function"?r.restoreState(n[t]):void 0);return i},p={frames:{},modals:{},layout:"default",go:"default//"},u={},c={"default":{start:"default",TRACKS:{"default":{start:"default",STEPS:{"default":{}}}}}},h={},a=!1,N=function(e){var t,n,r,i,s,o,u,f,l;if(a===!1){a={};for(i in h){r=h[i];if(!r.fists)continue;n=(u=r.group)!=null?u:p.group,(f=a[n])==null&&(a[n]={}),l=r.forms;for(s=0,o=l.length;s<o;s++)t=l[s],a[n][t]=i}}},T=function(){var e,t,n,s,o,a;for(n=0,s=A.length;n<s;n++){e=A[n],i=(o=r["app$"+e])!=null?o:{},i.STEPS&&z(c["default"].TRACKS["default"].STEPS,i.STEPS),i.TRACKS&&z(c["default"].TRACKS,i.TRACKS),a={SETTINGS:p,CLICKS:u,FLOWS:c,MODELS:h,OPTIONS:J};for(e in a)t=a[e],z(t,i[e])}U()},C=function(e,t){return e in h||config.a1(e),t in h[e]||J.a2(e,t),h[e][t]},y=function(e,t){return N(),aFist[e][t]},g=function(e,t,n,r,i){var s,o,u,a,f,l,h,p,d;o=c[e];if(o){if(t&&(a=(f=o.TRACKS)!=null?f[t]:void 0)!=null){if(n&&(u=(l=a.STEPS)!=null?l[n]:void 0)!=null&&(s=(h=u[r])!=null?h[i]:void 0)!=null)return s;if((s=(p=a[r])!=null?p[i]:void 0)!=null)return s}if((s=(d=o[r])!=null?d[i]:void 0)!=null)return s}return null},d=function(e,t,n,r){var i,s,o,u,a,f;s=c[e];if(s){if(t&&(u=(a=s.TRACKS)!=null?a[t]:void 0)!=null){if(n&&(o=(f=u.STEPS)!=null?f[n]:void 0)!=null&&(i=o[r])!=null)return i;if((i=u[r])!=null)return i}if((i=s[r])!=null)return i}return null},b=function(e){return c[e]},S=function(e,t){return c[e].TRACKS[t]},w=function(e,t,n){return c[e].TRACKS[t].STEPS[n]},L=function(e){return b(e).start},k=function(e,t){return S(e,t).start},v=function(e,t){var n;return(n=g(e[0],e[1],e[2],"CLICKS",t))!=null?n:u[t]},E=function(e,t,n,r){var i;return t?(i=d(t,n,r!=null?r:false,e))!=null?i:p[e]:p[e]},x=function(e,t,n){var r;return r=z({},c[e].v,c[e].TRACKS[t].v,c[e].TRACKS[t].STEPS[n].v),r},U=function(){var e,n,i;i=[];for(n in h)e=h[n],i.push(function(e,n){return r[e]=function(i,s,o,u){var a,f,l;return f=n.inst,f in V||(a=n["class"],r.Model[a]==null&&J.m1(e,n),V[f]=new r.Model[a](e,n.options),f in V&&V[f].restoreState(V[f])),l=V[f],i===t?l:s===t?l.getTable(i):l.action(i,s,o,u)}}(n,e));return i},_=function(e,t,n){var r;return r=m.deferred(),r.resolve(G(e,t,n)),r.promise},G=function(e,t,i){var s,o,u,a,f,l,c,h,p,d,g,y,b,w,E,S,x,T,N,C;a=":clickAction("+e+")",c=new n("App"),h=new n("App"),s=v(i,e);if(s==null)return _log2("WARNING","No app. entry for action_token ("+e+") on path ("+i+")"),[c,h];s.go!=null&&r.App().goTo(s.go),l=z({},t),g=function(){switch(Q(s.pass)){case"A":return s.pass;case"S":return s.pass.split(",");default:return[]}}();for(S=0,x=g.length;S<x;S++)d=g[S],d in t||_log2("WARNING","Action ("+e+") request data is missing param "+d,t,s,i);T=s.set;for(d in T)b=T[d],l[d]=b;if(s["do"]!=null){N=s["do"].split("."),E=N[0],w=N[1],u=m.deferred(),y={},f=new r.Issue(E,w),p=new r.Issue(E,w),o={d:u,r:y,i:f,m:p},r[E](o,w!=null?w:e,l),C=o.r;for(d in C)b=C[d],l[d]=b;c.addObj(o.i),h.addObj(o.m),[c,h]}return[c,h]},O=[],I=function(e){var t;return J.fg1(e(f(!((t=O[e])!=null?t:O[e]=r.oLoader.fist(e))))),O[e]},j=function(e,t){var n;return n=I(e),n.FISTS[t]||J.fg2(e,t),n.FISTS[t]},B=function(e){return I(e).FIELDS},F=function(e){return I(e).FISTS},H=function(e,t){var n,r,i,s,o,u;n=I(e),r={},u=j(e,t);for(s=0,o=u.length;s<o;s++)i=u[s],i in n.FIELDS||J.fg3(e,t,i),r[i]=n.FIELDS[i];return r},P=function(e,t){return t.split("_")[0]},Y={type_oau:Q,Model:o,Extra:s,option:J,click:M,merge:z,appconfs:A,appGetF:b,appGetT:S,appGetS:w,appStartT:L,appStartS:k,appFindClick:v,appGetSetting:E,appGetVars:x,oModel:V,oFist:X};for(W in Y)$=Y[W],r[W]=$;return r},e=function(){function e(e,n,r,i){var s;this.Epic=e,this.grp_nm=n,this.view_nm=i,s=this.Epic.getFistGroupCache(),r=s.getCanonicalFist(n,r),this.fist_nm=r,this.oM=E[this.view_nm](),this.form_state="empty",this.fistDef=s.getFistDef(n,this.fist_nm),this.cache_field_choice=[],this.filt=t,this.Fb_ClearValues(),this.upload_todo=[],this.upload_fl={},this.focus_fl_nm=!1}return e.prototype.getGroupNm=function(){return this.grp_nm},e.prototype.getFistNm=function(){return this.fist_nm},e.prototype.loadFieldDefs=function(){var e;return(e=this.fieldDef)!=null?e:this.fieldDef=this.Epic.getFistGroupCache().getFieldDefsForFist(this.grp_nm,this.fist_nm)},e.prototype.getFieldsDefs=function(){return this.loadFieldDefs()},e.prototype.loadFieldChoices=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;n={options:[],values:[]},this.loadFieldDefs(),t=this.fieldDef[e].type.split(":");switch(t[1]){case"custom":n=this.oM.fistGetFieldChoices(this,e);break;case"array":g=this.fieldDef[e].cdata;for(p=0,v=g.length;p<v;p++)s=g[p],typeof s=="object"?(n.options.push(String(s[1])),n.values.push(String(s[0]))):(n.options.push(String(s)),n.values.push(String(s)));break;case"json_like":r=this.fieldDef[e].cdata.replace(/'/g,'"').replace(/"""/g,"'"),r=JSON.parse(r);for(i in r)u=r[i],n.options.push(i),n.values.push(u);break;case"wist":y=this.fieldDef[e].cdata.split(":"),c=y[0],h=y[1],f=y[2],a=y[3],l=this.Epic.getViewTable("Wist/"+c+":"+h);for(d=0,m=l.length;d<m;d++)o=l[d],n.options.push(o[a]),n.values.push(o[f])}this.cache_field_choice[e]=n},e.prototype.getHtmlPostedFieldsList=function(e){var t;return t=this.fistDef,e!=null&&e!==this.fist_nm&&(t=this.Epic.getFistGroupCache().getFistDef(this.grp_nm,e)),t},e.prototype.getFieldAttributes=function(e){return this.Epic.getFistGroupCache().getFieldDefsForGroup(this.grp_nm)[e]},e.prototype.getHtmlFieldValue=function(e){return this.loadData(),this.fb_HTML[e]},e.prototype.getHtmlFieldValues=function(){return this.loadData(),_log2("getHtmlFieldValues",this.fist_nm,this.fb_HTML),this.fb_HTML},e.prototype.getDbFieldValue=function(e){return this.loadData(),this.fb_DB[e]},e.prototype.getDbFieldValues=function(){return this.loadData(),this.fb_DB},e.prototype.getFieldIssues=function(){return this.fb_issues},e.prototype.getFocus=function(){return this.focus_fl_nm},e.prototype.setFocus=function(e){return this.focus_fl_nm=e},e.prototype.getChoices=function(e){return this.loadFieldChoices(e),this.cache_field_choice[e]},e.prototype.fieldLevelValidate=function(e,t,n){return this.form_state="posted",this.Fb_FistValidate(e,t!=null?t:this.fist_nm,n!=null?n:!0)},e.prototype.loadData=function(e){this.form_state==="empty"&&(this.oM.fistLoadData(this),this.form_state="loaded")},e.prototype.setFromDbValues=function(e){this.Fb_SetHtmlValuesFromDb(e),this.form_state="loaded"},e.prototype.setFromHTMLValues=function(e){this.Fb_SetHtmlValuesFromHtml(e),this.form_state="loaded"},e.prototype.eventNewRequest=function(e){e.step&&(this.clearValues(),this.upload_todo=[],this.uploaded_fl={})},e.prototype.clearIssues=function(e){e?delete this.fb_issues[e]:this.fb_issues={}},e.prototype.clearValues=function(){this.form_state!=="empty"&&(this.Fb_ClearValues(),this.form_state="empty")},e.prototype.Fb_SetHtmlValuesFromDb=function(e){var t,n,r,i;t=this.Fb_DbNames();for(r=0,i=t.length;r<i;r++)n=t[r],n in e&&(this.fb_DB[n]=e[n]);return this.Fb_Db2Html()},e.prototype.Fb_SetHtmlValuesFromHtml=function(e){return this.Fb_Html2Html(e,this.fist_nm),null},e.prototype.Fb_ClearValues=function(){return this.fb_DB={},this.fb_HTML={},this.fb_issues={},this.Fb_Db2Html()},e.prototype.Fb_FistValidate=function(e,t,r){var i;return r===!0&&(this.fb_issues={}),this.Fb_Html2Html(e,t),i=new n,i.call(this.Fb_Check(t)),i.count()===0&&(this.Fb_Html2Db(t),i.call(this.Fb_Check(t,!0))),i},e.prototype.Fb_DbNames=function(e){var t,n,r,i,s;if(e!=null&&e!==this.fist_nm)return function(){var t,r,i,s;i=this.getHtmlPostedFieldsList(e),s=[];for(t=0,r=i.length;t<r;t++)n=i[t],s.push(this.fieldDef[n].db_nm);return s}.call(this);if(this.fb_DB_names==null){this.loadFieldDefs(),this.dbNm2HtmlNm={},i=this.fieldDef;for(n in i)r=i[n],this.dbNm2HtmlNm[r.db_nm]=n;(s=this.fb_DB_names)==null&&(this.fb_DB_names=function(){var e;e=[];for(t in this.dbNm2HtmlNm)e.push(t);return e}.call(this))}return this.fb_DB_names},e.prototype.Fb_Make=function(e,t,r){var i;return r===!0?!1:((i=this.issue_inline)==null&&(this.issue_inline=E.oA.getShowIssues()==="inline"),this.issue_inline?(this.fb_issues[t]=n.Make(this.view_nm,r[0],r[1]),e.count()===0&&e.add("FORM_ERRORS",[this.fistName])):e.add(r[0],r[1]),!0)},e.prototype.Fb_Html2Html=function(e,t){var n,r,i,s,o;this.loadFieldDefs(),o=this.getHtmlPostedFieldsList(t);for(i=0,s=o.length;i<s;i++)n=o[i],r=e[n],"H2H_prefilter"in this.filt&&(r=this.filt.H2H_prefilter(n,this.fieldDef[n].h2h,r)),this.fb_HTML[n]=this.filt.H2H_generic(n,this.fieldDef[n].h2h,r)},e.prototype.Fb_Check=function(e,t){var r,i,s,o,u,a,f,l,c,h,p,d;s=new n,p=this.Fb_DbNames(e);for(f=0,c=p.length;f<c;f++){r=p[f],u=this.dbNm2HtmlNm[r],i=this.fieldDef[u];if(t&&i.type!=="psuedo")continue;if(i.type!=="psuedo"||t)this.Fb_Make(s,u,this.Fb_Validate(u,this.fb_HTML[u]));else{o=0,d=i.cdata;for(l=0,h=d.length;l<h;l++)a=d[l],this.Fb_Make(s,u,this.Fb_Validate(u+"_"+a,this.fb_HTML[u+"_"+a]))&&(issue_cnt+=1)}}return s},e.prototype.Fb_Validate=function(e,t){var n,r;this.loadFieldDefs(),n=(r=this.fieldDef[e])!=null?r:this.getFieldAttributes(e);if(t==null||t.length===0)return n.req===!0?n.req_text?["FIELD_EMPTY_TEXT",[e,n.label,n.req_text]]:["FIELD_EMPTY",[e,n.label]]:!0;return n.max_len>0&&t.length>n.max_len?["FIELD_OVER_MAX",[e,n.label,n.max_len]]:this.filt["CHECK_"+n.validate](e,n.validate_expr,t,this)?!0:n.issue_text?["FIELD_ISSUE_TEXT",[e,n.label,n.issue_text]]:["FIELD_ISSUE",[e,n.label]]},e.prototype.Fb_Html2Db=function(e){var t,n,r,i,s,o,u,a;this.loadFieldDefs(),a=this.getHtmlPostedFieldsList(e);for(o=0,u=a.length;o<u;o++)n=a[o],t=this.fieldDef[n],i="",t.type!=="psuedo"?s=this.fb_HTML[n]:(i="_psuedo",s=function(){var e,i,s,o;s=t.cdata,o=[];for(e=0,i=s.length;e<i;e++)r=s[e],o.push(this.fb_HTML[n+"_"+r]);return o}.call(this)),this.fb_DB[t.db_nm]=this.filt["H2D_"+t.h2d+i](n,t.h2d_expr,s)},e.prototype.Fb_Db2Html=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;d=this.Fb_DbNames(),m=[];for(l=0,h=d.length;l<h;l++){e=d[l],i=this.dbNm2HtmlNm[e],t=this.fieldDef[i],o=(t!=null?t.type:void 0)==="psuedo"?!0:!1;if(!(e in this.fb_DB)){if(!o)this.fb_HTML[i]=null;else{v=t.cdata;for(c=0,p=v.length;c<p;c++)a=v[c],this.fb_HTML[i+"_"+a]=null}continue}f=this.fb_DB[e],u="";if(!o)m.push(this.fb_HTML[i]=this.filt["D2H_"+t.d2h](e+"%"+i,t.d2h_expr,f));else switch(t.cdata.length){case 0:m.push(option.fb1(t));break;case 1:m.push(BROKEN());break;default:r=this.filt["D2H_"+t.d2h+"_psuedo"](e+"%"+i,t.d2h_expr,f),m.push(function(){var e,o,u,a;u=t.cdata,a=[];for(n=e=0,o=u.length;e<o;n=++e)s=u[n],a.push(this.fb_HTML[i+"_"+s]=r[n]);return a}.call(this))}}return m},e}(),t=function(){function e(){}return e.H2H_generic=function(e,t,n){var r,i,s,o,u;i=n!=null?n:"",o=typeof (u=t!=null?t:"").split=="function"?u.split(":"):void 0;for(r in o)s=o[r],i=function(){switch(s){case"":return i;case"trim_spaces":return String(i).trim();case"digits_only":return i.replace(/[^0-9]/g,"");case"lower_case":return i.toLowerCase();case"upper_case":return i.toUpperCase();default:return option.ff1(e,t,s)}}();return i},e.CHECK_=function(e,t,n,r){return!0},e.CHECK_null=function(e,t,n,r){return!0},e.CHECK_undefined=function(e,t,n,r){return!0},e.CHECK_any=function(e,t,n,r){return!0},e.CHECK_phone=function(e,t,n,r){var i,s;switch(t){case undef:n=n.replace(/[^0-9]/g,""),i="[0-9]{10}";break;default:BROKE()}return s=new RegExp("^"+i+"$"),n.match(s)?!0:!1},e.CHECK_zip=function(e,t,n,r){switch(t){case"5or9":if(!n.match(/^[0-9]{5}(|[0-9]{4})$/))return!1;break;default:BROKE()}return!0},e.CHECK_choice=function(e,t,n,r){return _log2("CHECK_choice:value/values",n,r.getChoices(e).values),c.call(r.getChoices(e).values,n)<0?!1:t&&r.getChoices(e).values[0]===n?!1:!0},e.CHECK_email=function(e,t,n,r){var i,s,o,u;return s="[A-Z0-9._+%-]",u="[A-Z0-9.-]",i="[A-Z]",o=new RegExp("^"+s+"+@"+u+"+[.]"+i+"{2,4}$","i"),n.match(o)?!0:!1},e.CHECK_regexp=function(e,t,n,r){var i;return i=new RegExp("^"+t+"$"),n.match(i)?!0:!1},e.CHECK_confirm=function(e,t,n,r){var i;return i=r.getHtmlFieldValue(t),i!==n?!1:!0},e.H2D_=function(e,t,n){return n},e.H2D_undefined=function(){return this.H2D_.apply(this,arguments)},e.H2D__psuedo=function(e,t,n){return n},e.H2D_date_psuedo=function(e,t,n){var r,i,s;return s=n[0],i=n[1],r=n[2],s==null&&i==null&&r==null?"":(s==null&&(s=""),i==null&&(i=""),r==null&&(r=""),s.length===1&&(s="0"+s),i.length===1&&(i="0"+i),""+r+"-"+s+"-"+i)},e.H2D_join_psuedo=function(e,t,n){return n.join(t)},e.H2D_phone=function(e,t,n){return n.replace(/[^0-9]/g,"")},e.H2D_zero_is_blank=function(e,t,n){return n===0||n==="0"?"":n},e.D2H_=function(e,t,n){return n},e.D2H_undefined=function(){return this.D2H_.apply(this,arguments)},e.D2H_null=function(){return this.D2H_.apply(this,arguments)},e.D2H_phone=function(e,t,n){return n=n.replace(/[^0-9]/g,""),n.replace(/(...)(...)(...)/,"($1) $2-$3")},e.D2H_date=function(e,t,n){return this.D2H_date_psuedo(e,t,n).join("/")},e.D2H_date_psuedo=function(e,t,n){var r,i,s,o;return o=(n!=null?n:"--").split(/[^0-9-]/)[0].split("-"),r=o[0],s=o[1],i=o[2],[(s!=null?s:"").replace(/^0/,""),(i!=null?i:"").replace(/^0/,""),r]},e.D2H_blank_is_zero=function(e,t,n){return n.length?n:"0"},e}(),n=function(){function e(e,t){this.t_view=e,this.t_action=t,this.issue_list=[]}return e.Make=function(t,n,r){var i;return i=new e(t),i.add(n,r),i},e.prototype.add=function(e,t){switch(typeof t){case"undefined":t=[];break;case"string":t=[t]}return this.issue_list.push({token:e,more:t,t_view:this.t_view,t_action:this.t_action})},e.prototype.addObj=function(e){var t,n,r,i,s,o,u;if(!(typeof e=="object"&&"issue_list"in e))return;s=e.issue_list;for(r=0,i=s.length;r<i;r++)t=s[r],n=E.merge({},t),(o=n.t_view)==null&&(n.t_view=this.t_view),(u=n.t_action)==null&&(n.t_action=this.t_action),this.issue_list.push(n)},e.prototype.count=function(){return this.issue_list.length},e.prototype.asTable=function(e){var t,n,r,i,s;t=[],s=this.issue_list;for(r=0,i=s.length;r<i;r++)n=s[r],t.push({token:n.token,title:""+n.t_view+"#"+n.t_action+"#"+n.token+"#"+n.more.join(","),issue:this.map(e,n.t_view,n.t_action,n.token,n.more)});return t},e.prototype.map=function(e,t,n,r,i){var s,o,u,a,f,l,c,h;if(typeof e!="object")return""+t+"#"+n+"#"+r+"#"+i.join(",");s=[],t in e&&(n in e[t]&&s.push(e[t][n]),"default"in e[t]&&s.push(e[t]["default"])),"default"in e&&(n in e["default"]&&s.push(e["default"][n]),"default"in e["default"]&&s.push(e["default"]["default"]));for(a=0,l=s.length;a<l;a++){u=s[a],h=u||[];for(f=0,c=h.length;f<c;f++){o=h[f];if(r.match(o[0]))return this.doMap(r,o[1],i,r)}}return""+t+"#"+n+"#"+r+"#"+i.join(",")},e.prototype.doMap=function(e,t,n){var r;return r=t.replace(/%([0-9])(?::([0-9]))?%/g,function(t,r,i,s){return r==="0"?e:i?n[r-1]||n[i-1]||"":n[r-1]||""}),r},e}(),r=function(){function e(e,t,n){this.view_nm=e,this.options=t,this._ModelJS={ss:n||!1},this.restoreState(!1)}return e.prototype.getTable=function(e){return this.loadTableIf(e),this.Table[e]},e.prototype.loadTableIf=function(e){if(!(e in this.Table))return this.loadTable(e)},e.prototype.restoreState=function(e){var t;if(this._ModelJS.ss!=null)for(t in this._ModelJS.ss)delete this[t];return this._ModelJS.ss!=null&&E.merge(this,this._ModelJS.ss),e&&E.merge(this,e),this.Table={}},e.prototype.saveState=function(){var e,t,n;t=this._ModelJS.ss;if(!t)return!1;n={};for(e in t)this[e]!==t[e]&&(n[e]=this[e]);return E.merge({},n)},e.prototype.invalidateTables=function(e,t){var n,r,i;t==null&&(t=[]),e===!0&&(e=function(){var e;e=[];for(n in this.Table)c.call(t,n)>=0||e.push(n);return e}.call(this));for(r=0,i=e.length;r<i;r++)n=e[r],delete this.Table[n];return E.View().invalidateTables(this.view_nm,e)},e}(),u=typeof window!="undefined"?window:{},u.EpicMvc=u.E=new i(u),a={Issue:n,Fist:e,ModelJS:r,FistFilt:t};for(o in a)s=a[o],u.E[o]=s;u._log2=function(){},u._log2=Function.prototype.bind.call(console.log,console),typeof module!="undefined"&&module!==null&&(module.exports=u.E),typeof define=="function"&&define.amd&&define(function(){return u.E})}).call(this);
/*Package/Base/app.coffee*/(function(){E.app$Base={MANIFEST:{Extra:["LoadStrategy","RenderStrategy","dataAction"],Model:["App","View"]},OPTIONS:{loader:"LoadStrategy$Base",render:"RenderStrategy$Base",data_action:"dataAction$Base"},MODELS:{App:{"class":"App$Base",inst:"iBaseApp"},View:{"class":"View$Base",inst:"iBaseView"}}}}).call(this);
/*Package/Base/Model/View.coffee*/(function(){"use strict";var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},i=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};e=function(e){function n(e,r){this.T_if=t(this.T_if,this),this.T_page=t(this.T_page,this),this.handleIt=t(this.handleIt,this),this.doDefer=t(this.doDefer,this);var i,s,o;n.__super__.constructor.call(this,e,r),i=E.appGetSetting("frames"),this.frames=function(){var e,t,n,r;n=function(){var e;e=[];for(o in i)e.push(o);return e}().sort(),r=[];for(e=0,t=n.length;e<t;e++)s=n[e],r.push(i[s]);return r}(),this.frames.push("X"),this.did_run=!1,this.in_run=!1,window.oE=this,this.defer_it_cnt=0,this.start=!1}return r(n,e),n.prototype.nest_up=function(e){return this.defer_it_cnt===0&&(this.in_run&&BLOWUP(),this.in_run=!0,this.defer_it=new m.Deferred),this.defer_it_cnt++},n.prototype.nest_dn=function(e){this.defer_it_cnt>0&&this.defer_it_cnt--;if(this.defer_it_cnt===0)return this.in_run=!1,this.defer_it.resolve(this.defer_content)},n.prototype.run=function(){var e,t,n,r,i,s,o;return i="R",s=E.App().getStepPath(),e=s[0],r=s[1],n=s[2],t=E.appGetSetting("layout",e,r,n),this.page_name=(o=E.appGetS(e,r,n).page)!=null?o:n,this.did_run=!0,this.frames[this.frames.length-1]=t,this.frame_inx=0,this.resetInfo(),this.nest_up(i),this.defer_content=this.kids([["page",{}]]),this.nest_dn(i),this.defer_it.promise},n.prototype.resetInfo=function(){return this.info_foreach={},this.info_parts=[{}],this.info_if_nms={},this.info_defer=[[]]},n.prototype.saveInfo=function(){var e,t,n,r,i,s;e={},r={},s=this.info_foreach;for(t in s)n=s[t],e[t]=n.dyn,r[t]=n.row._COUNT;return i=E.merge({},{info_foreach:{dyn:e,row_num:r},info_parts:this.info_parts}),i},n.prototype.restoreInfo=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;this.resetInfo(),y=e.info_foreach.dyn,b=[];for(o in y){f=y[o],r=f[0],i=f[1],n=f[2],t=[],u=E[r]();for(m=0,g=n.length;m<g;m++)d=n[m],l=d[0],c=d[1],t.push(d),c in this.info_foreach?a=this.info_foreach[c].row:(t.length===1?v=u.getTable(l):v=a[l],p=e.info_foreach.row_num[c],h=E.merge({},v[p]),this.info_foreach[c]={dyn:[r,i,t],row:h},a=h);b.push(s=E.merge([],e.info_parts))}return b},n.prototype.getTable=function(e){var t,n,r,i,s;switch(e){case"Control":case"Form":return this.fist_table[e];case"If":return[this.info_if_nms];case"Part":return this.info_parts.slice(-1);case"Field":n={},s=this.fist_table.Control;for(r=0,i=s.length;r<i;r++)t=s[r],n[t.name]=[t];return[n];default:return[]}},n.prototype.invalidateTables=function(e,t){if(!this.did_run)return;m.startComputation(),m.endComputation()},n.prototype.wrap=function(e,t,n,r,i){var s,o=this;return s={defer:r},t.config=function(e,t,n){var i,u,a,f;a=s.defer,f=[];for(i=0,u=a.length;i<u;i++)r=a[i],f.push(o.doDefer(r,e));return f},t["data-part"]=e,"dynamic"in t?{tag:t.dynamic,attrs:t,children:n}:n?i?n:{tag:"div",attrs:t,children:n}:""},n.prototype.doDefer=function(e,t){var n=this;return"A"===E.type_oau(e.defer)?(_log2("WARNING","Got an array for defer",e.defer),"WAS-ARRAY"):e.func?e.func(t,e.attrs):e.defer.then(function(r){e.func=new Function("el","attrs",r),n.doDefer(e,t)})},n.prototype.handleIt=function(e){return typeof e=="function"&&(e=e()),e},n.prototype.formatFromSpec=function(e,t,n){var r,i,s,o,u;switch(t){case void 0:return e;case"":return n?typeof (o=window.EpicMvc).custom_filter=="function"?o.custom_filter(e,n):void 0:e;case"count":return e!=null?e.length:void 0;case"bool":return e?!0:!1;case"bytes":return window.bytesToSize(Number(e));case"uriencode":return encodeURIComponent(e);case"esc":return window.EpicMvc.escape_html(e);case"quo":return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"');case"1":return String(e)[0];case"lc":return String(e).toLowerCase();case"ucFirst":return s=String(s).toLowerCase(),s.slice(0,1).toUpperCase()+s.slice(1);default:return t[0]==="?"?(u=t.slice(1).split("?"),r=u[0],i=u[1],(e?r:i!=null?i:"").replace(new RegExp("[%]","g"),e)):e}},n.prototype.v3=function(e,t,n,r,i){var s;return s=E[e](t)[0],this.formatFromSpec(s[n],r,i)},n.prototype.v2=function(e,t,n,r,i){var s;return s=this.info_foreach[e].row[t],i!=null&&(s=s[i]),this.formatFromSpec(s,n,r)},n.prototype.weed=function(e){var t,n,r;t={};for(n in e)r=e[n],n[0]!=="-"?t[n]=r:r&&(t[n.slice(1)]=r);return t},n.prototype.kids=function(e){var t,n,r,i,s,o,u,a=this;s="K",i=[];for(n=o=0,u=e.length;o<u;n=++o)r=e[n],"A"===E.type_oau(r)?(i.push(n),t=this["T_"+r[0]](r[1],r[2]),(t!=null?t.then:void 0)?(this.nest_up(s),function(e){return t.then(function(t){return i[e]=t,a.nest_dn(s)})}(n)):i[n]=t):i.push(r);return i},n.prototype.loadPartAttrs=function(e){var t,n,r;n={};for(t in e){r=e[t];if("data-e-"!==t.slice(0,7))continue;n[t.slice(7)]=r}return n},n.prototype.T_page=function(e){var t,n,r;return this.frame_inx<this.frames.length?(t=E.oLoader.d_layout(n=this.frames[this.frame_inx++]),r=(this.frame_inx<this.frames.length?"frame":"layout")+"/"+n):(t=E.oLoader.d_page(n=this.page_name),r="page/"+n),this.piece_handle(r,e!=null?e:{},t)},n.prototype.T_part=function(e){var t,n;return n=e.part,t=E.oLoader.d_part(n),this.piece_handle(n,e,t,!0)},n.prototype.piece_handle=function(e,t,n,r){var i,s,o,u;return(n!=null?n.then:void 0)?this.D_piece(e,t,n,r):(s=n.content,i=n.can_componentize,this.info_parts.push(this.loadPartAttrs(t)),this.info_defer.push([]),s=this.handleIt(s),o=this.info_defer.pop(),i||t.dynamic||o.length||!r?(o.length&&!i&&!t.dynamic&&_log2("WARNING: DEFER logic in ("+e+"); wrapping DIV tag."),u=this.wrap(e,t,s,o,i)):u=s,u)},n.prototype.D_piece=function(e,t,n,r){var i,s,o,u=this;return o="P",this.nest_up(o+e),s=this.saveInfo(),i=n.then(function(n){var i;return(n!=null?n.then:void 0)&&BLOWUP(),u.restoreInfo(s),i=u.piece_handle(e,t,n,r),u.nest_dn(o+e),i}),i},n.prototype.T_defer=function(e,t){var n;return n=this.handleIt(t),this.info_defer[this.info_defer.length-1].push({attrs:e,func:new Function("el","attrs",n)}),""},n.prototype.T_if_true=function(e,t){return this.info_if_nms[e.name]?this.handleIt(t()):""},n.prototype.T_if_false=function(e,t){return this.info_if_nms[e.name]?"":this.handleIt(t)},n.prototype.T_if=function(e,t){var n,r,s,o,u,a,f,l;r=!1,n=!1;if("val"in e)if("eq"in e)e.val===e.eq&&(n=!0);else if("ne"in e)e.val!==e.ne&&(n=!0);else if("in_list"in e){if(f=e.val,i.call(e.in_list.split(","),f)>=0)n=!0}else r=!0;else"set"in e?n=e.set?!0:!1:"not_set"in e?n=e.not_set?!1:!0:"table_is_not_empty"in e?(a=e.table_is_not_empty,l=a.split("/"),s=l[0],o=l[1],u=this._accessModelTable(a,!1)[0],u.length&&(n=!0)):r=!0;return r&&console.log("ISSUE T_if",e),"name"in e&&(this.info_if_nms[e.name]=n),n&&t?this.handleIt(t):""},n.prototype._accessModelTable=function(e,t){var n,r,i,s,o,u,a,f,l,c,h;return l=e.split("/"),s=l[0],u=l[1],s in this.info_foreach?(f=this.info_foreach[s].row[u],c=this.info_foreach[s].dyn,r=c[0],i=c[1],n=c[2]):(o=E[s](),f=o.getTable(u),h=[s,u,[]],r=h[0],i=h[1],n=h[2]),f.length===0?[f,u,s,u,o]:(a=u,t&&(a=t),n.push([u,a]),this.info_foreach[a]={dyn:[r,i,n]},[f,a,s,u,o])},n.prototype.T_foreach=function(e,t){var n,r,i,s,o,u,a,f,l;l=this._accessModelTable(e.table,e.alias),u=l[0],s=l[1];if(u.length===0)return"";i=[],r="limit"in e?Number(e.limit)-1:u.length;for(n=a=0,f=u.length;a<f;n=++a)o=u[n],o=u[n],this.info_foreach[s].row=o,this.info_foreach[s].count=n,i.push(this.handleIt(t));return delete this.info_foreach[s],i},n.prototype.T_fist=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B;y=(L=e.part)!=null?L:"fist_default",b=(A=e.row)!=null?A:!1,s=e.form,d=E.fist(s),v=e.field!=null?e.field:!1,u=(O=e.help)!=null?O:"",x="show_req"in e?e.show_req:"yes",t=!1,f=!0,g=[],a=function(){var e;e=[];for(p in d.getHtmlFieldValues())e.push(p);return e}(),l=d.getFieldIssues(),o=d.getFocus(),h=E["issues$"+E.appGetSetting(E.App().path(),"group")];for(N=0,k=a.length;N<k;N++){i=a[N];if(v!==!1&&v!==i)continue;m=d.getFieldAttributes(i),r=E.merge({tip:"",fistnm:s,focus:""},m),i===o&&(r.focus="yes"),r.is_first=f===!0?"yes":"",f=!1,r.yes_val=r.type==="yesno"?String((M=r.cdata)!=null?M:"1"):"not_used",r.req=r.req===!0?"yes":"",r.req===!0&&(t=!0),r.name=i,(_=r["default"])==null&&(r["default"]=""),r["default"]=String(r["default"]),T=b?i+"__"+b:i,r.value=(D=d.getHtmlFieldValue(T))!=null?D:r["default"],r.selected=r.type==="yesno"&&r.value===r.yes_val?"yes":"",r.id="U"+E.nextCounter(),r.type=r.type.split(":")[0],(P=r.width)==null&&(r.width=""),(H=r.size)==null&&(r.size="");if(r.type==="radio"||r.type==="pulldown"){n=d.getChoices(i),w=[];for(c=C=0,B=n.options.length;0<=B?C<B:C>B;c=0<=B?++C:--C)S=n.values[c]===String(r.value)?"yes":"",w.push({option:n.options[c],value:n.values[c],selected:S});r.Choice=w}r.issue=l[T]?l[T].asTable(h)[0].issue:"",g.push(r)}return this.fist_table={Form:[{show_req:x,any_req:t,help:u}],Control:g},this.T_part({part:y})},n}(E.ModelJS),E.Model.View$Base=e}).call(this);
/*Package/Base/Model/App.coffee*/(function(){"use strict";var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};e=function(e){function t(e,n){var r;r={f:null,t:null,s:null,sp:[]},t.__super__.constructor.call(this,e,n,r)}return n(t,e),t.prototype.goTo=function(e,t,n){var r,i;r=""+this.f+"/"+this.t+"/"+this.s;if(!e||E.appGetF(e)==null)i=E.appGetOpt("go").split("/"),e=i[0],t=i[1],n=i[2];else if(t==null||E.appGetT(e,t)==null)t=E.appStartT(e),n=E.appStartS(e,t);else if(n==null||E.appGetS(e,t,n)==null)n=E.appStartS(e,t);this.f=e,this.t=t,this.s=n;if(r!==""+this.f+"/"+this.t+"/"+this.s)return this.invalidateTables(["V"])},t.prototype.go=function(e){var t,n,r,i,s,o,u;n=e.split("/"),o=[this.f,this.t,this.s];for(t=i=0,s=o.length;i<s;t=++i){r=o[t];if((u=n[t])!=null?!!u.length:!!void 0)break;n[t]=r}return this.goTo(n[0],n[1],n[2])},t.prototype.appGet=function(e){return E.appGetAttr(this.f,this.t,this.s,e)},t.prototype.getStepPath=function(){return[this.f,this.t,this.s]},t.prototype.action=function(e,n,r){var i,s,o,u;u=e.r,i=e.i,s=e.m;switch(n){case"path":return this.go(r.path);case"push":return this.sp.push([this.f,this.t,this.s]);case"pop":if(this.sp.length)return o=this.sp.pop(),this.goTo(o[0],o[1],o[2]);break;case"add_message":return s.add(r.type,r.msgs);case"add_issue":return i.add(r.type,r.msgs);case"clear":return this.issues=new E.Issue(this.view_nm),this.messages=new E.Issue(this.view_nm),this.invalidateTables(["Issue","Message"]);default:return t.__super__.action.call(this,e,n,r)}},t.prototype.setIssues=function(e){return(e!=null?e.count():void 0)!==0&&this.issues.addObj(e),this.invalidateTables(["Issue"])},t.prototype.setMessages=function(e){return(e!=null?e.count():void 0)!==0&&this.messages.addObj(e),this.invalidateTables(["Message"])},t.prototype.getTable=function(e){var n;n=E["issues$"+this.appGet("group")],this.Table[e]=function(){switch(e){case"Message":return this.messages.asTable(n);case"Issue":return this.issues.asTable(n);case"V":return[E.appGetVars(this.f,this.t,this.s)];default:return t.__super__.getTable.call(this,e)}}.call(this)},t}(E.ModelJS),E.Model.App$Base=e}).call(this);
/*Package/Base/Extra/dataAction.coffee*/(function(){var e;e=function(e,t,n){var r,i,s,o,u,a,f,l,c;typeof (u=E.option).activity=="function"&&u.activity(e),r=t.split(","),c=[];for(a=0,f=r.length;a<f;a++){i=r[a],l=i.split(":"),o=l[0],s=l[1],s||(s=o,o="click"),o===e&&function(e){return setTimeout(function(){return E.click(e,n)},5)}(s);break}return c},E.Extra.dataAction$Base=e}).call(this);
/*Package/Base/Extra/LoadStrategy.coffee*/(function(){var e;e=function(){function e(e){var t;this.reverse_packages=function(){var n,r,s;s=[];for(t=n=r=e.length-1;r<=0?n<=0:n>=0;t=r<=0?++n:--n)s.push(e[t]);return s}()}return e.prototype.getArtifact=function(e,t){var n,r,i,s,o,u,a,f;r=!1,o=this.reverse_packages;for(i=0,s=o.length;i<s;i++){n=o[i],r=(u=(a=E["view$"+n])!=null?(f=a[t])!=null?f[e]:void 0:void 0)!=null?u:!1;if(r!==!1)break}return r===!1&&console.log("NO FILE FOUND! "+e),r},e.prototype.D_loadAsync=function(){var e;return e=new m.Deferred,e.resolve(),e.promise},e.prototype.fist=function(e){return BROKEN(),E["fist$"+e]},e.prototype.d_layout=function(e){return this.getArtifact(e,"Layout")},e.prototype.d_page=function(e){return this.getArtifact(e,"Page")},e.prototype.d_part=function(e){return this.getArtifact(e,"Part")},e}(),E.Extra.LoadStrategy$Base=e}).call(this);
/*Package/Base/Extra/RenderStrategy.coffee*/(function(){"use strict";var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(){this.m_redraw=t(this.m_redraw,this),this.onPopState=t(this.onPopState,this),this.handleEvent=t(this.handleEvent,this);var e,n=this;this.very_first=!0,this.was_popped=!1,this.was_modal=!1,this.unloadMsgs={},this.baseUrl=window.document.location.pathname,this.baseId="epic-new-page",this.modalId="epic-new-modal",this.basePage='<div id="'+this.baseId+'"></div><div id="'+this.modalId+'"></div>',e=document.createElement("div"),e.id=this.baseId,document.body.appendChild(e),setTimeout(function(){return n.onPopState(!0)},0),window.onpopstate=this.onPopState,this.redraw_guard=!1,m.redraw=this.m_redraw,this.init(),!0}return e.prototype.handleEvent=function(e){var t,n,r,i,s,o,u,a,f,l;e==null&&(e=window.event),o=e.target;while(o.tagName!=="BODY"&&!(n=o.getAttribute("data-e-action")))o=o.parentElement;if(!n)return!1;r={},t=o.attributes;for(i=f=0,l=t.length;0<=l?f<l:f>l;i=0<=l?++f:--f){if("data-e-"!==t[i].name.slice(0,7))continue;if("action"===(s=t[i].name.slice(7)))continue;r[s]=t[i].value}return u=e.type,a=o.value,e.preventDefault(),r.val=a,E.Extra[E.option.data_action](e.type,n,r),!1},e.prototype.init=function(){var e,t,n,r,i;r=["click","change","dblclick"],i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(document.body["on"+e]=this.handleEvent);return i},e.prototype.UnloadMessage=function(e,t){var n,r,i;return t?this.unloadMsgs[e]=t:delete this.unloadMsgs[e],n=function(){var e,t;e=this.unloadMsgs,t=[];for(r in e)i=e[r],t.push(i);return t}.call(this),n=n.length?n.join("\n"):null,window.onbeforeunload=function(){return n}},e.prototype.onPopState=function(e){if(e===!0||!e.state)if(this.was_popped||!this.very_first)return;this.was_popped=!0,this.very_first?E.click("browser_hash",{hash:location.hash.substr(1)}):(e.state&&E.setModelState(e.state),BROKEN()||this.render())},e.prototype.m_redraw=function(){var e=this;if(this.redraw_guard!==!1)return;return this.redraw_guard=!0,E.View().run().then(function(t){return _log2("DEFER-R","RESULTS: content",t),e.render(t,"TODO","TODO",!1),e.redraw_guard=!1})},e.prototype.render=function(e,t,n,r){var i,s;this.was_modal&&(BROKEN(),m.render(document.getElementById(this.modalId),m())),r?(BROKEN(),m.render(i=document.getElementById(this.modalId),this.modalView(e))):(_log2("START RENDER",s=(new Date).getTime()),m.render(i=document.getElementById(this.baseId),m("div",{},e)),_log2("END RENDER",(new Date).getTime()-s)),console.log("render......",this.content_watch,i),this.was_modal=r,this.was_popped=!1,this.very_first=!1},e.prototype.handleRenderState=function(e,t){var n,r,i,s,o;if(!e)return;n=this.very_first?"":"click-"+t,i=E.getDomCache(),i===!1&&(i=E.getExternalUrl()),i!==!1&&(n=i),r=E.getModelState(),this.very_first||e==="replace"?typeof (s=window.history).replaceState=="function"&&s.replaceState(r,n,"#"+n):!this.was_popped&&e===!0&&(typeof (o=window.history).pushState=="function"&&o.pushState(r,n,"#"+n),window.document.title=n)},e}(),E.Extra.RenderStrategy$Base=e}).call(this);
E.view$Base={
Layout: {
"default":{preloaded:1,can_componentize:false,defer:0,content:function(){return oE.kids([['page',{},function(){return []}]])}}}, Page: {
"default":{preloaded:1,can_componentize:true,defer:0,content:function(){return [{tag:'b',attrs:{},children:['A Base Page']}]}}}, Part: {
}};

